{% extends "base.html" %}

{% block content %}
<div class="fade-in">
    <h1 class="text-3xl font-bold mb-6">Panel de Administración</h1>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
        <div class="admin-card">
            <h2 class="text-xl font-semibold mb-4">Estadísticas Generales</h2>
            <div class="admin-stat" id="total-redemptions">0</div>
            <div class="admin-stat-label">Total de canjes</div>
        </div>
        <div class="admin-card">
            <h2 class="text-xl font-semibold mb-4">Top 5 Beneficios</h2>
            <ul id="top-benefits" class="space-y-2">
                <li class="skeleton-text"></li>
                <li class="skeleton-text"></li>
                <li class="skeleton-text"></li>
                <li class="skeleton-text"></li>
                <li class="skeleton-text"></li>
            </ul>
        </div>
        <div class="admin-card">
            <h2 class="text-xl font-semibold mb-4">Acciones Rápidas</h2>
            <a href="{{ url_for('admin.add_benefit') }}" class="btn-primary block text-center mb-4">Agregar Nuevo Beneficio</a>
            <a href="{{ url_for('admin.categories') }}" class="btn-secondary block text-center mb-4">Gestionar Categorías</a>
            <a href="{{ url_for('admin.analytics') }}" class="btn-primary block text-center">Ver Analytics Dashboard</a>
        </div>
    </div>

    <h2 class="text-2xl font-semibold mb-4">Lista de Beneficios</h2>
    <div class="overflow-x-auto bg-white rounded-lg shadow">
        <table class="min-w-full">
            <thead>
                <tr>
                    <th class="px-6 py-3 border-b border-gray-200 bg-gray-50 text-left text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider">Nombre</th>
                    <th class="px-6 py-3 border-b border-gray-200 bg-gray-50 text-left text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider">Categoría</th>
                    <th class="px-6 py-3 border-b border-gray-200 bg-gray-50 text-left text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider">Empresa</th>
                    <th class="px-6 py-3 border-b border-gray-200 bg-gray-50 text-left text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider">Destacado</th>
                    <th class="px-6 py-3 border-b border-gray-200 bg-gray-50 text-left text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for benefit in benefits %}
                <tr>
                    <td class="px-6 py-4 whitespace-no-wrap border-b border-gray-200">{{ benefit.name }}</td>
                    <td class="px-6 py-4 whitespace-no-wrap border-b border-gray-200">{{ benefit.category.name }}</td>
                    <td class="px-6 py-4 whitespace-no-wrap border-b border-gray-200">{{ benefit.company }}</td>
                    <td class="px-6 py-4 whitespace-no-wrap border-b border-gray-200">
                        <form action="{{ url_for('admin.toggle_featured', id=benefit.id) }}" method="POST" class="inline">
                            <button type="submit" class="{% if benefit.featured %}text-yellow-500{% else %}text-gray-500{% endif %} hover:text-yellow-700 transition-colors duration-300">
                                {% if benefit.featured %}★{% else %}☆{% endif %}
                            </button>
                        </form>
                    </td>
                    <td class="px-6 py-4 whitespace-no-wrap border-b border-gray-200">
                        <a href="{{ url_for('admin.edit_benefit', id=benefit.id) }}" class="text-indigo-600 hover:text-indigo-900 mr-4 transition-colors duration-300">Editar</a>
                        <form class="delete-form inline" action="{{ url_for('admin.delete_benefit', id=benefit.id) }}" method="POST">
                            <button type="submit" class="text-red-600 hover:text-red-900 transition-colors duration-300">Eliminar</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/admin.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Fetch and display stats with animation
        fetch('/admin/stats')
            .then(response => response.json())
            .then(data => {
                const totalRedemptions = document.getElementById('total-redemptions');
                const topBenefitsList = document.getElementById('top-benefits');

                gsap.to(totalRedemptions, {
                    innerHTML: data.total_redemptions,
                    duration: 2,
                    ease: 'power2.out',
                    snap: { innerHTML: 1 }
                });

                topBenefitsList.innerHTML = '';
                data.top_benefits.forEach((benefit, index) => {
                    const li = document.createElement('li');
                    li.textContent = `${index + 1}. ${benefit.name}`;
                    li.classList.add('opacity-0');
                    topBenefitsList.appendChild(li);

                    gsap.to(li, {
                        opacity: 1,
                        duration: 0.5,
                        delay: index * 0.1
                    });
                });
            })
            .catch(error => console.error('Error fetching stats:', error));

        // Add hover animation to table rows
        const tableRows = document.querySelectorAll('tbody tr');
        tableRows.forEach(row => {
            row.addEventListener('mouseenter', () => {
                gsap.to(row, { backgroundColor: '#f3f4f6', duration: 0.3 });
            });
            row.addEventListener('mouseleave', () => {
                gsap.to(row, { backgroundColor: 'white', duration: 0.3 });
            });
        });
    });
</script>
{% endblock %}
